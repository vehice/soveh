{% extends 'layout.html' %}
{% load static %}
{% block stylesheets %}
{% endblock stylesheets %}
{% block content_header %}
<div class="content-header row">
  <div class="content-header-left col-md-6 col-12 mb-2">
    <h3 class="content-header-title mb-0">Ingresos</h3>
    <div class="row breadcrumbs-top">
      <div class="breadcrumb-wrapper col-12">
        <ol class="breadcrumb">
          <li class="breadcrumb-item">
            <a href="/">Home</a>
          </li>
          <li class="breadcrumb-item">
            <a href="#">Ingresos</a>
          </li>
        </ol>
      </div>
    </div>
  </div>
  <div class="content-header-right col-md-6 col-12">
    <div class="float-md-right">
      <!-- <div class="dropdown dropleft">
        <button type="button" class="btn btn-info btn-lg btn-block dropdown-toggle" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Nuevo Caso
        </button>
        <div class="dropdown-menu dropdown-menu-left" aria-labelledby="dropdownMenuButton">
          <a href="/ingresos/new" class="dropdown-item">
            Ingreso completo
          </a>
          <a href="/ingresos/new" class="dropdown-item">
            Ingreso solo análisis
          </a>
          <a href="/ingresos/new" class="dropdown-item">
            Ingreso corte incluído
          </a>
        </div>
      </div> -->
      <a href="/ingresos/new" class="btn btn-info btn-lg btn-block">
        Nuevo Caso
      </a>
    </div>
  </div>
</div>
{% endblock content_header %} {% block content %}
<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h4 class="card-title">Listado de Ingresos</h4>
      </div>
      <div class="card-content">
        <div class="card-body card-dashboard">
          <table class="table table-striped table-bordered zero-configuration">
            <thead>
              <tr>
                <!-- <th>Id</th> -->
                <th>Nro Caso</th>
                <th>Subflujo</th>
                <th>Cliente</th>
                <th>Fecha Inicio</th>
                <th>Etapa en curso</th>
              </tr>
            </thead>
            <tbody>
              {% for entryForm in entryForm_list %}
                  <tr>
                    <!-- <td>{{ entryForm.content_object.id }}</td> -->
                    <td><strong>{{ entryForm.content_object.no_caso }}</strong></td>
                    <td>
                      {% if entryForm.content_object.get_subflow != "N/A" %}
                        Parte {{ entryForm.content_object.get_subflow }}
                      {% else %}
                        {{ entryForm.content_object.get_subflow }}
                      {% endif %}
                    </td>
                    <td>{{ entryForm.content_object.customer }}</td>
                    <td>{{ entryForm.content_object.created_at|date:"d/m/Y" }}</td>
                    <td><a href="workflow/{{ entryForm.id }}/{{ entryForm.state.step.tag }}">{{ entryForm.state.step }}</a></td>
                  </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock content %} {% block scripts %}
<script type="text/javascript">

  function format ( d ) {
    // console.log(d);
// `d` is the original data object for the row
    return ' <table width="100%" class="table table-xs table-borderless" style="margin: 0% !important;">'+
        '<tr class="bg-teal bg-lighten-5">'+
            '<td>1.1</td>'+
            '<td><a href="#">Paso 2 - Flujo Ingreso</a></td>'+
        '</tr>'+
        '<tr class="bg-teal bg-lighten-5">'+
            '<td>1.2</td>'+
            '<td><a href="#">Paso 4 - Flujo Ingreso</a></td>'+
        '</tr>'+
        '<tr class="bg-teal bg-lighten-5">'+
            '<td>1.3</td>'+
            '<td><a href="#">Paso 1 - Flujo Análisis</a></td>'+
        '</tr>'+
    '</table>';
    }

  $(document).ready(function () {
    var tableChildRows = $('.zero-configuration').DataTable({
      language: {
        url: "https://cdn.datatables.net/plug-ins/1.10.16/i18n/Spanish.json"
      },
      "order": [[0, 'desc']]
    });

    $('.zero-configuration tbody').on('click', 'td.details-control', function () {
        var tr = $(this).closest('tr');
        var row = tableChildRows.row( tr );
        // console.log(row);

        if ( row.child.isShown() ) {
          row.child.hide();
          tr.removeClass('shown');
        }
        else {
          row.child( format(row.data()) ).show();
          tr.addClass('shown');
        }
    });

  });


</script> {% endblock scripts %}
